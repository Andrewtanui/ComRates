@model IEnumerable<TanuiApp.Models.WishlistItem>

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">My Wishlist</h2>
        <div>
            <a asp-controller="Products" asp-action="Index" class="btn btn-outline-secondary me-2">Continue Shopping</a>
            <a href="@Url.Action("MyCart", "Cart")" class="btn btn-primary">View Cart</a>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    @if (!Model.Any())
    {
        <div class="text-center p-4">
            <img src="/images/empty-wishlist-illustration-svg.png" alt="Empty wishlist" style="max-width:360px;width:70%;height:auto" />
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var item in Model)
            {
                <div class="col-md-4">
                    <div class="card h-100 shadow-sm">
                        <a asp-controller="Products" asp-action="Details" asp-route-id="@(item.Product?.Id ?? 0)" class="text-decoration-none text-dark">
                            <img src="@(string.IsNullOrEmpty(item.Product?.ImageUrl) ? "/images/placeholder-product.svg" : item.Product.ImageUrl)" class="card-img-top" alt="@(item.Product?.Name ?? "product")" onerror="this.onerror=null;this.src='/images/placeholder-product.svg'" />
                        </a>
                        <div class="card-body">
                            <h5 class="card-title">@(item.Product?.Name ?? "[Product removed]")</h5>
                            <p class="card-text text-muted">@(item.Product?.Description?.Split('.')[0] ?? "")</p>
                            <p class="card-text"><strong>Price: @(item.Product != null ? item.Product.Price.ToString("C") : "-")</strong></p>
                            <p class="card-text"><small class="text-muted">Added: @item.DateAdded.ToString("MMM dd, yyyy")</small></p>
                        </div>
                        <div class="card-footer">
                            <div class="btn-group w-100" role="group">
                                <form method="post" action="@Url.Action("MoveToCart")" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="wishlistItemId" value="@item.Id" />
                                    <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-shopping-cart"></i> Add to Cart</button>
                                </form>
                                <form method="post" action="@Url.Action("RemoveFromWishlist")" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="wishlistItemId" value="@item.Id" />
                                    <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Remove this item from your wishlist?')"><i class="fas fa-trash"></i> Remove</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>